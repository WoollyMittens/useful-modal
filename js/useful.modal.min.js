/*
	Source:
	van Creij, Maurice (2012). "modal.js: A simple modal dialog", version 20120606, http://www.woollymittens.nl/.

	License:
	This work is licensed under a Creative Commons Attribution 3.0 Unported License.

	Prerequisites:
	<script src="./js/useful.js"></script>
	<!--[if IE]>
		<script src="./js/html5.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<![endif]-->
*/(function(e){"use strict";var t={};t={setup:function(n,r){e.events.add(n,"click",function(i){e.events.cancel(i);t.open(n,i,r)})},open:function(n,r,i){i.id||(i.id="modalDialog");i["class"]||(i["class"]=n.className.indexOf("class_")>-1?n.className.split("class_")[1].split(" ")[0]:"");i.title||(i.title=n.title?n.title:n.innerHTML);i.href||(i.href=n.href);i.width||(i.width=n.className.indexOf("width_")>-1?parseInt(n.className.split("width_")[1].split(" ")[0],10):null);i.height||(i.height=n.className.indexOf("height_")>-1?parseInt(n.className.split("height_")[1].split(" ")[0],10):null);var s=document.getElementById(i.id);s&&s.parentNode.removeChild(s);s=document.createElement("DIV");s.setAttribute("id",i.id);s.className=i["class"];var o=document.createElement("DIV");o.id=i.id+"_background";o.className=i.id+"_background_hidden";var u=document.createElement("DIV");u.id=i.id+"_foreground";u.className=i.id+"_foreground_hidden";var a=document.createElement("H1");a.innerHTML=i.title;a.id=i.id+"_title";var f=document.createElement("BUTTON");f.innerHTML="X";f.id=i.id+"_closer";e.events.add(f,"click",function(n){t.close(i);e.events.cancel(n)});var l=document.createElement("IFRAME");l.id=i.id+"_content";l.name=i.id+"_iframe";l.setAttribute("frameborder",0);s.appendChild(o);u.appendChild(a);u.appendChild(f);u.appendChild(l);s.appendChild(u);document.body.appendChild(s);t.update({id:i.id,width:i.width,height:i.height});if(navigator.userAgent.indexOf("MSIE 6")>-1){var c=document.getElementsByTagName("SELECT");for(var h=0,p=c.length;h<p;h+=1)c[h].style.visibility="hidden"}setTimeout(function(){e.css.setClass(o,"modalDialog_background_hidden","modalDialog_background_visible");setTimeout(function(){e.css.setClass(u,"modalDialog_foreground_hidden","modalDialog_foreground_visible");setTimeout(function(){l.src=i.href},500)},500)},500);e.events.cancel(r)},close:function(t){t.id||(t.id="modalDialog");var n=document.getElementById(t.id);if(n){var r=document.getElementById(t.id+"_foreground"),i=document.getElementById(t.id+"_background");setTimeout(function(){e.css.setClass(r,"modalDialog_foreground_visible","modalDialog_foreground_hidden");setTimeout(function(){e.css.setClass(i,"modalDialog_background_visible","modalDialog_background_hidden");setTimeout(function(){n.parentNode.removeChild(n)},500)},500)},500)}if(navigator.userAgent.indexOf("MSIE 6")>-1){var s=document.getElementsByTagName("SELECT");for(var o=0,u=s.length;o<u;o+=1)s[o].style.visibility="visible"}},update:function(e){e.id||(e.id="modalDialog");var t=document.getElementById(e.id);if(t){t=document.getElementById(e.id);var n=document.getElementById(e.id+"_background"),r=document.getElementById(e.id+"_foreground"),i=document.getElementById(e.id+"_title"),s=document.getElementById(e.id+"_content");e["class"]&&(t.className=e["class"]);e.title&&(i.innerHTML=e.title);e.href&&(s.src=e.href);if(e.width){r.style.width=e.width+"px";s.width=e.width;s.style.width=e.width+"px";r.style.marginLeft=Math.round(-1*e.width/2)+"px"}if(e.height){r.style.height=e.height+i.offsetHeight+"px";s.height=e.height;s.style.height=e.height+"px";r.style.marginTop=Math.round(-1*(e.height+i.offsetHeight)/2)+"px"}if(navigator.userAgent.indexOf("MSIE 6")>-1){t.style.height=document.body.offsetHeight+"px";n.style.height=document.body.offsetHeight+"px"}}}};e.events=e.events||{};e.events.add=function(e,t,n){t=navigator.userAgent.match(/Firefox/i)&&t.match(/mousewheel/i)?"DOMMouseScroll":t;"addEventListener"in e?e.addEventListener(t,n,!1):"attachEvent"in e?e.attachEvent("on"+t,function(e){n(e)}):e["on"+t]=n};e.events.cancel=function(e){e&&(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)};e.models=e.models||{};e.models.clone=function(e){var t,n;if(typeof Object.create!="undefined")t=Object.create(e);else{n=function(){};n.prototype=e;t=new n}return t};e.models.trim=function(e){return e.replace(/^\s+|\s+$/g,"")};e.css=e.css||{};e.css.select=function(t,n){var r,i,s;n=n||document;t=typeof t=="string"?{rule:t,parent:n}:t;t.parent=t.parent||document;t.data=t.data||{};s=typeof document.querySelectorAll!="undefined"?t.parent.querySelectorAll(t.rule):typeof jQuery!="undefined"?jQuery(t.parent).find(t.rule).get():[];if(typeof t.handler=="undefined")return s;for(r=0,i=s.length;r<i;r+=1)t.handler(s[r],e.models.clone(t.data))};e.css.prefix=function(e){return navigator.userAgent.match(/webkit/gi)?"webkit"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/firefox/gi)?"Moz"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/microsoft/gi)?"ms"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/opera/gi)?"O"+e.substr(0,1).toUpperCase()+e.substr(1):e};e.css.compatibility=function(){var e,t,n;t=document.createElement("div");typeof t.style.MozTransition!="undefined"&&(e="transitionend");try{document.createEvent("OTransitionEvent");e="oTransitionEnd"}catch(r){n=null}try{document.createEvent("WebKitTransitionEvent");e="webkitTransitionEnd"}catch(r){n=null}try{document.createEvent("transitionEvent");e="transitionend"}catch(r){n=null}t=n;return e};e.css.setClass=function(t,n,r,i,s,o){var u,a,f,l;i=i||function(){};f=e.css.compatibility();u=new RegExp(e.models.trim(n).replace(/ {2,}/g," ").split(" ").join("|"),"g");a=new RegExp(r,"g");if(typeof f!="undefined"){t.addEventListener(f,l=function(){i();t.removeEventListener(f,l,!0)},!0);t.className=e.models.trim(t.className.replace(u,"")+" "+r).replace(/ {2,}/g," ")}else if(typeof jQuery!="undefined"&&typeof jQuery.ui!="undefined"){s=s||500;o=o||"swing";jQuery(t).switchClass(n.replace(a,""),r,s,o,i)}else{t.className=e.models.trim(t.className.replace(u,"")+" "+r).replace(/ {2,}/g," ");i()}};e.modal={};e.modal.setup=t.setup;e.modal.update=t.update;e.modal.close=t.close})(window.useful=window.useful||{});